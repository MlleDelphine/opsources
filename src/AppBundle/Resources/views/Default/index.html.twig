{% extends 'AppBundle::layout.html.twig' %}
{% block body %}
<div class="row col-lg-12">
    <div class="col-lg-12">
        <div class="col-lg-12">
            <h1 class="page-header">Dashboard

                <button id="btn_creation_entretien" class=" btn btn-primary btn-lg pull-right" type="button" onclick="showCreation();">
                    <i class="fa fa-plus" style="margin-right:20px;"></i>
                    Création d'un entretien à la demande</button>

            </h1>

        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div id="creation_entretien" class="row col-lg-12">
        <div class="col-lg-12">
            <h2>Création d’un ou de plusieurs entretiens à la demande</h2>
            <div class="panel panel-default">
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table" id="createSheet">
                            <thead>
                            <tr>
                                <th></th>
                                {% for type in types %}
                                    <th>{{ type.name }}</th>
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                            {% for u in user.opusSheetsEvaluator %}
                                <tr>
                                    <td>{{ u.evaluate.firstName }} {{ u.evaluate.lastName }}</td>
                                    {% for type in types %}
                                            {% set canCreate = 1 %}
                                            {% for e in u.evaluate.opusSheetsEvaluate %}
                                                {% if( e.opusTemplate.type == type and e.status.intCode != -1 and e.status.intCode != 8 and e.status.intCode != 9 and e.status is not empty ) %}
                                                    {% set canCreate = 0 %}
                                                {% endif %}
                                            {% endfor %}
                                            <td>
                                                {% if canCreate == 1 %}
                                                    <input type="checkbox" name="" value="" sheetType="{{ type.strCode }}" user="{{ user.id }}">
                                                {% else %}
                                                    <input type="checkbox" name="" value="" sheetType="{{ type.strCode }}" user="{{ user.id }}"  disabled="disabled" >
                                                {% endif %}
                                            </td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <input type="submit" value="Créer" class="btn btn-primary pull-right btn-lg" onclick="createSheet();">
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>
    <div class="row col-lg-12">
        <div class="row col-lg-12">
{#            <div class="col-lg-4 col-md-4 col-xs-12">
                <div class="panel panel-yellow">
                    <div class="panel-heading">
                        <div class="row">
                            <h2 class="col-xs-12">Professionnel</h2>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <span class="pull-left">En attente de validation de l'évaluateur</span>

                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-xs-12">
                <div class="panel panel-orange">
                    <div class="panel-heading">
                        <div class="row">
                            <h2 class="col-xs-12">Conditions</h2>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <span class="pull-left">A valider</span>

                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>#}


            {% for type in types %}
                {% set done = 0  %}
                    {% for o in user.opusSheetsEvaluate %}
                        {% if o.opusTemplate.type == type %}
                            {% set sheet = o %}
                            {% if( o.status.intCode != -1 and o.status.intCode != 8 and o.status.intCode != 9 and o.status is not empty ) %}
                                {% set done = 1 %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% set color = "done" %}
                {% if ( done == 0 and sheet is defined ) %}
                    {% if sheet.getEcheance() > 60 %}
                        {% set color = "yellow" %}
                    {% elseif sheet.getEcheance() > 30 %}
                        {% set color = "orange" %}
                    {% elseif sheet.getEcheance() > 0 %}
                        {% set color = "green" %}
                    {% endif %}
                {%  endif %}
                <div class="col-lg-{{ 12/types|length }} col-md-{{ 12/types|length }} col-xs-12">
                    <div class="panel panel-{{ color }}">
                        <div class="panel-heading">
                            <div class="row">
                                <h2 class="col-xs-12">{{ type.name }}</h2>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <span class="pull-left">
                                {{ ( sheet is defined and done == 0 ) ? sheet.status.label : '' }}
                            </span>

                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            {% endfor %}

        </div>

        <!-- /.row -->
        <div class="">
            <div class="col-lg-12">
                <h2>Les entretiens dont je suis l’évaluateur en cours</h2>
                <div class="panel panel-default">
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>Appréciation</th>
                                    <th>Professionnel</th>
                                    <th>Conditions de travail</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>Jean-Jacques LEFEVRE</td>
                                    <td class="table-orange">A Faire</td>
                                    <td class="table-orange"></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>Jean-Jacques LEFEVRE</td>
                                    <td></td>
                                    <td class="table-orange">A Faire</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>Jean-Jacques LEFEVRE</td>
                                    <td></td>
                                    <td></td>
                                    <td class="table-orange"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-6 -->



            <div class="col-lg-12">
                <h2>Les fiches d’entretien de mon équipe</h2>
                <div class="panel panel-default">
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>Appréciation</th>
                                    <th>Professionnel</th>
                                    <th>Conditions de travail</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>Jean-Jacques LEFEVRE</td>
                                    <td class="table-orange">A Faire</td>
                                    <td class="table-orange"></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>Jean-Jacques LEFEVRE</td>
                                    <td></td>
                                    <td class="table-orange">A Faire</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>Jean-Jacques LEFEVRE</td>
                                    <td></td>
                                    <td></td>
                                    <td class="table-orange"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
        </div>
        <!-- /.row -->
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function showCreation(){
            $b = $(document).find("#creation_entretien");
            if($b.css('display') === "block")
                $b.hide();
            else
                $b.show();
        }

        function createSheet(){
            $t =$(document).find("#createSheet");
            $n = 0;
            $("input[type=\"checkbox\"]").each(function(i,j){
               if($(this).is(":checked"))
               {
                   $n++;
                   $path = '{{ path("generator_newsheet",{"id":"__USER__"}) }}' + '/' + $(this).attr("sheetType");
                   $path = $path.replace("__USER__",$(this).attr("user"));
                   $.post($path,function(d){
                       alert("yo");
                   })
               }
            });
            alert("GG :" + $n);
        }
    </script>

{%  endblock %}



